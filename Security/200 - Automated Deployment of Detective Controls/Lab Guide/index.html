<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Level 200: Automated Deployment of Detective Controls: Lab Guide - My Docs</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">My Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">Welcome to MkDocs</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cost <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../Cost/">AWS Well-Architected Cost Optimization Labs</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Cost Fundamentals</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">100 1 AWS Account Setup</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_1_AWS_Account_Setup/">Level 100: AWS Account Setup</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_1_AWS_Account_Setup/Checklist/">Level 100: AWS Account Setup: Best Practice Checklist</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_1_AWS_Account_Setup/Lab Guide/">Level 100: AWS Account Setup: Lab Guide</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">100 2 Cost and Usage Governance</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_2_Cost_and_Usage_Governance/">Level 100: Cost and Usage Governance</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_2_Cost_and_Usage_Governance/Checklist/">Level 100: Cost and Usage Governance</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_2_Cost_and_Usage_Governance/Lab Guide/">Level 100: Cost and Usage Governance</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">100 4 Cost and Usage Analysis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_4_Cost_and_Usage_Analysis/">Level 100: Cost and Usage Analysis</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_4_Cost_and_Usage_Analysis/Checklist/">Level 100: Cost and Usage Analysis</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_4_Cost_and_Usage_Analysis/Lab Guide/">Level 100: Cost and Usage Analysis</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">100 5 Cost Visualization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_5_Cost_Visualization/">Level 100: Billing Visualization</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_5_Cost_Visualization/Checklist/">Level 100: Cost Visualization</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/100_5_Cost_Visualization/Lab Guide/">Level 100: Cost Visualization</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">200 2 Cost and Usage Governance</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_2_Cost_and_Usage_Governance/">Level 200: Cost and Usage Governance</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_2_Cost_and_Usage_Governance/Checklist/">Level 200: Cost and Usage Governance</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_2_Cost_and_Usage_Governance/Lab Guide/">Level 200: Cost and Usage Governance</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">200 3 Pricing Models</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_3_Pricing_Models/">Level 200: Pricing Models</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_3_Pricing_Models/Checklist/">Level 200: Pricing Models Checklist</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_3_Pricing_Models/Lab Guide/">Level 200: Pricing Models</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">200 4 Cost and Usage Analysis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_4_Cost_and_Usage_Analysis/">Level 200: Cost and Usage Analysis</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_4_Cost_and_Usage_Analysis/Checklist/">Level 200: Cost and Usage Analysis</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_4_Cost_and_Usage_Analysis/Lab Guide/">Level 200: Cost and Usage Analysis</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">200 5 Cost Visualization</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_5_Cost_Visualization/">Level 200: Cost Visualization</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_5_Cost_Visualization/Checklist/">Level 200: Cost Visualization</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_Fundamentals/200_5_Cost_Visualization/Lab Guide/">Level 200: Cost Visualization</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Cost and Usage Analysis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_and_Usage_Analysis/">AWS Well-Architected Cost Optimization Labs</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">300 Automated CUR Updates and Ingestion</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Cost/Cost_and_Usage_Analysis/300_Automated_CUR_Updates_and_Ingestion/">Level 300: Automated CUR Updates and Ingestion</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_and_Usage_Analysis/300_Automated_CUR_Updates_and_Ingestion/Checklist/">Level 300: Automated CUR Updates and Ingestion</a>
</li>
            
<li >
    <a href="../../../Cost/Cost_and_Usage_Analysis/300_Automated_CUR_Updates_and_Ingestion/Lab Guide/">Level 300: Automated CUR Updates and Ingestion</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reliability <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../Reliability/">AWS Well-Architected Reliability Labs</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">300   Testing for Resiliency of EC2, RDS, and S3</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Reliability/300 - Testing for Resiliency of EC2, RDS, and S3/">Level 300: Testing for Resiliency of EC2, RDS, and S3</a>
</li>
            
<li >
    <a href="../../../Reliability/300 - Testing for Resiliency of EC2, RDS, and S3/Builders Guide/">Builders Guide for 300 - Testing for Resiliency of EC2, RDS, and S3</a>
</li>
            
<li >
    <a href="../../../Reliability/300 - Testing for Resiliency of EC2, RDS, and S3/Lab Guide/">Level 300: Performing Resiliency Testing for EC2, RDS, and S3</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Security <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../">AWS Well-Architected Security Labs</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">100   AWS Account & Root User</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../100 - AWS Account & Root User/">Level 100: AWS Account & Root User</a>
</li>
            
<li >
    <a href="../../100 - AWS Account & Root User/Checklist/">Level 100: AWS Account & Root User: Best Practice Checklist</a>
</li>
            
<li >
    <a href="../../100 - AWS Account & Root User/Lab Guide/">Level 100: AWS Account & Root User: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">100   Basic Identity & Access Management User, Group, Role</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../100 - Basic Identity & Access Management User, Group, Role/">Level 100: Basic Identity & Access Management User, Group, Role</a>
</li>
            
<li >
    <a href="../../100 - Basic Identity & Access Management User, Group, Role/Checklist/">Level 100: Basic Identity & Access Management User, Group, Role: Best Practice Checklist</a>
</li>
            
<li >
    <a href="../../100 - Basic Identity & Access Management User, Group, Role/Lab Guide/">Level 100: Basic Identity & Access Management User, Group, Role: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">100   CloudFront with S3 Bucket Origin</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../100 - CloudFront with S3 Bucket Origin/">Level 100: CloudFront with S3 Bucket Origin</a>
</li>
            
<li >
    <a href="../../100 - CloudFront with S3 Bucket Origin/Lab Guide/">Level 100: CloudFront with S3 Bucket Origin: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   Automated Deployment of Detective Controls</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../">Level 200: Automated Deployment of Detective Controls</a>
</li>
            
<li class="active">
    <a href="./">Level 200: Automated Deployment of Detective Controls: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   Automated Deployment of EC2 Web Application</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../200 - Automated Deployment of EC2 Web Application/">Level 200: Automated Deployment of EC2 Web Application</a>
</li>
            
<li >
    <a href="../../200 - Automated Deployment of EC2 Web Application/Lab Guide/">Level 200: Automated Deployment of EC2 Web Application</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   Automated Deployment of IAM Groups and Roles</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../200 - Automated Deployment of IAM Groups and Roles/">Level 200: Automated Deployment of IAM Groups and Roles</a>
</li>
            
<li >
    <a href="../../200 - Automated Deployment of IAM Groups and Roles/Lab Guide/">Level 200: Automated Deployment of IAM Groups and Roles: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   Automated Deployment of VPC</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../200 - Automated Deployment of VPC/">Level 200: Automated Deployment of VPC</a>
</li>
            
<li >
    <a href="../../200 - Automated Deployment of VPC/Lab Guide/">Level 200: Automated Deployment of VPC</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   Basic EC2 with WAF Protection</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../200 - Basic EC2 with WAF Protection/">Level 200: EC2 Web Infrastructure Protection</a>
</li>
            
<li >
    <a href="../../200 - Basic EC2 with WAF Protection/Checklist/">Level 100: EC2 Web Infrastructure Protection: Best Practice Checklist</a>
</li>
            
<li >
    <a href="../../200 - Basic EC2 with WAF Protection/Lab Guide/">Level 200: EC2 Web Infrastructure Protection: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">200   CloudFront with WAF Protection</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../200 - CloudFront with WAF Protection/">Level 200: CloudFront with WAF Protection</a>
</li>
            
<li >
    <a href="../../200 - CloudFront with WAF Protection/Lab Guide/">Level 100: CloudFront with WAF Protection: Lab Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">300   IAM Permission Boundaries Delegating Role Creation</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../300 - IAM Permission Boundaries Delegating Role Creation/">Level 300: IAM Permission Boundaries Delegating Role Creation</a>
</li>
            
<li >
    <a href="../../300 - IAM Permission Boundaries Delegating Role Creation/Lab Guide/">Level 300: IAM Permission Boundaries Delegating Role Creation</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">300   IAM Tag Based Access Control for EC2</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../300 - IAM Tag Based Access Control for EC2/">Level 300: IAM Tag Based Access Control for EC2</a>
</li>
            
<li >
    <a href="../../300 - IAM Tag Based Access Control for EC2/Lab Guide/">Level 300: IAM Tag Based Access Control for EC2</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../200 - Automated Deployment of EC2 Web Application/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#level-200-automated-deployment-of-detective-controls-lab-guide">Level 200: Automated Deployment of Detective Controls: Lab Guide</a></li>
            <li><a href="#authors">Authors</a></li>
            <li><a href="#table-of-contents">Table of Contents</a></li>
            <li><a href="#1-aws-cloudformation-to-configure-customized-aws-cloudtrail">1. AWS CloudFormation to Configure Customized AWS CloudTrail </a></li>
            <li><a href="#2-aws-cloudformation-to-configure-amazon-guardduty">2. AWS CloudFormation to Configure Amazon GuardDuty </a></li>
            <li><a href="#3-aws-cloudformation-to-configure-aws-config">3. AWS CloudFormation to Configure AWS Config </a></li>
            <li><a href="#references-useful-resources">References &amp; useful resources:</a></li>
            <li><a href="#license">License</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="level-200-automated-deployment-of-detective-controls-lab-guide">Level 200: Automated Deployment of Detective Controls: Lab Guide</h1>
<h2 id="authors">Authors</h2>
<ul>
<li>Ben Potter, Security Lead, Well-Architected</li>
</ul>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#cloudtrail">CloudTrail</a></li>
<li><a href="#guardduty">GuardDuty</a></li>
<li><a href="#config">Config</a></li>
<li><a href="#tear_down">Tear Down</a></li>
</ol>
<h2 id="1-aws-cloudformation-to-configure-customized-aws-cloudtrail">1. AWS CloudFormation to Configure Customized AWS CloudTrail <a name="cloudtrail"></a></h2>
<p><a href="https://aws.amazon.com/cloudtrail/">AWS CloudTrail</a> is a service that enables governance, compliance, operational auditing, and risk auditing of your AWS account. With CloudTrail, you can log, continuously monitor, and retain account activity related to actions across your AWS infrastructure. CloudTrail provides event history of your AWS account activity, including actions taken through the AWS Management Console, AWS SDKs, command line tools, and other AWS services.
Using <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a>, we are going to create a new Amazon
S3 bucket, and configure CloudTrail to send events to the bucket and to <a href="https://aws.amazon.com/cloudwatch/">Amazon CloudWatch Logs</a>
for further analysis.</p>
<ol>
<li>Sign in to the AWS Management Console, select your preferred region, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.</li>
<li>Click <strong>Create stack</strong>.<br />
<img alt="cloudformation-createstack-1" src="../Images/cloudformation-createstack-1.png" />  </li>
<li>Enter the following <strong>Amazon S3 URL</strong>: <code>https://s3-us-west-2.amazonaws.com/aws-well-architected-labs/Security/Code/baseline-cloudtrail.yaml</code> and click <strong>Next</strong>.<br />
<img alt="cloudformation-createstack-s3" src="../Images/cloudformation-createstack-s3.png" />   </li>
<li>Enter the following details:</li>
<li>Stack name: The name of this stack. For this lab, use <code>cloudtrail</code>.</li>
<li>CloudTrailBucketName: The name of the new S3 bucket to create for CloudTrail to send logs to.  <strong>IMPORTANT</strong> Specify a bucket name that is unique.  </li>
<li>S3AccessLogsBucketName: The name of an existing S3 bucket for storing S3 access logs (optional).</li>
<li>CloudWatchLogsRetentionTime: Number of days to retain logs in CloudWatch Logs.</li>
<li>EncryptLogs: (optional) Use AWS KMS to encrypt logs stored in Amazon S3. A new KMS key will be created.</li>
<li>BucketPolicyExplicitDeny: (optional) Explicitly deny destructive actions to the bucket. AWS root user will be required to modify this bucket if configured.</li>
<li>ExpirationDays: Number of days to retain logs in the S3 bucket before they are automatically deleted.
<img alt="cloudformation-cloudtrail-params" src="../Images/cloudformation-cloudtrail-params.png" /></li>
<li>At the bottom of the page click <strong>Next</strong>.</li>
<li>In this lab, we won't add any tags or other options. Click Next. Tags, which are key-value pairs, can help you identify your stacks. For more information, see <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide//cfn-console-add-tags.html">Adding Tags to Your AWS CloudFormation Stack</a>.</li>
<li>Review the information for the stack. When you're satisfied with the configuration, check <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong> then click <strong>Create stack</strong>.<br />
<img alt="cloudformation-createstack-final" src="../Images/cloudformation-createstack-final.png" />  </li>
<li>After a few minutes the stack status should change from <em>CREATE_IN_PROGRESS</em> to <em>CREATE_COMPLETE</em>.
You have now set up AWS CloudTrail to log to your bucket and retain events, giving you the ability to search history and later enable pro-active monitoring of your AWS account!</li>
</ol>
<h2 id="2-aws-cloudformation-to-configure-amazon-guardduty">2. AWS CloudFormation to Configure Amazon GuardDuty <a name="guardduty"></a></h2>
<p><a href="https://aws.amazon.com/guardduty/">Amazon GuardDuty</a> is a threat detection service that continuously monitors for malicious or unauthorized behavior to help you protect your AWS accounts and workloads. It monitors for activity such as unusual API calls or potentially unauthorized deployments that indicate a possible account compromise. GuardDuty also detects potentially compromised instances or reconnaissance by attackers.
Using <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a>, we are going to configure GuardDuty, and configure alerting to your email address.</p>
<ol>
<li>Sign in to the AWS Management Console, select your preferred region, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.</li>
<li>Click <strong>Create stack</strong>.
<img alt="cloudformation-createstack-1" src="../Images/cloudformation-createstack-1.png" />  </li>
<li>Enter the following <strong>Amazon S3 URL</strong>: <code>https://s3-us-west-2.amazonaws.com/aws-well-architected-labs/Security/Code/baseline-guardduty.yaml</code> and click <strong>Next</strong>.<br />
<img alt="cloudformation-createstack-s3" src="../Images/cloudformation-createstack-s3.png" />  </li>
<li>Enter the following details:</li>
<li>Stack name: The name of this stack. For this lab, use <code>guardduty</code>.</li>
<li>CWEventId: The event Id for CloudWatch, leave as default.</li>
<li>EmailAddress: The email address you own that will receive the alerts, you must have access to this address for testing.</li>
<li>SNSTopicName: The name of the SNS topic to create, leave as default.
<img alt="cloudformation-cloudtrail-params" src="../Images/cloudformation-guardduty-params.png" />  </li>
<li>At the bottom of the page click <strong>Next</strong>.</li>
<li>In this lab, we won't add any tags or other options. Click Next. Tags, which are key-value pairs, can help you identify your stacks. For more information, see <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide//cfn-console-add-tags.html">Adding Tags to Your AWS CloudFormation Stack</a>.</li>
<li>Review the information for the stack. When you're satisfied with the configuration, click <strong>Create stack</strong>.  </li>
<li>After a few minutes the stack status should change from <em>CREATE_IN_PROGRESS</em> to <em>CREATE_COMPLETE</em>.</li>
<li>You should receive an email to confirm the SNS email subscription, you must confirm this.
You have now set up Amazon GuardDuty to detect threats and email alerts.</li>
</ol>
<h2 id="3-aws-cloudformation-to-configure-aws-config">3. AWS CloudFormation to Configure AWS Config <a name="config"></a></h2>
<p><a href="https://aws.amazon.com/config/">AWS Config</a> is a service that enables you to assess, audit, and evaluate the configurations of your AWS resources. Config continuously monitors and records your AWS resource configurations and allows you to automate the evaluation of recorded configurations against desired configurations.
Using <a href="https://aws.amazon.com/config/">AWS Config</a>, we are going to create a new Amazon
S3 bucket, and configure Config to save snapshots to the bucket.</p>
<ol>
<li>Sign in to the AWS Management Console, select your preferred region, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.</li>
<li>Click <strong>Create stack</strong>.<br />
<img alt="cloudformation-createstack-1" src="../Images/cloudformation-createstack-1.png" />  </li>
<li>Enter the following <strong>Amazon S3 URL</strong>: <code>https://s3-us-west-2.amazonaws.com/aws-well-architected-labs/Security/Code/baseline-config.yaml</code> and click <strong>Next</strong>.<br />
<img alt="cloudformation-createstack-s3" src="../Images/cloudformation-createstack-s3.png" /> 4. Enter the following details:</li>
<li>Stack name: The name of this stack. For this lab, use <code>config</code>.</li>
<li>ConfigBucketName: The name of the new S3 bucket to create for Config to save config snapshots to.  <strong>IMPORTANT</strong> Specify a bucket name that is unique.  </li>
<li>S3AccessLogsBucketName: The name of an existing S3 bucket for storing S3 access logs (optional).</li>
<li>InfrequentAccessTransitionTime: Number of days to keep S3 objects in standard tier before moving to infrequently accessed.</li>
<li>BucketPolicyExplicitDeny: (optional) Explicitly deny destructive actions to the bucket. AWS root user will be required to modify this bucket if configured.
<img alt="cloudformation-config-params" src="../Images/cloudformation-config-params.png" />  </li>
<li>At the bottom of the page click <strong>Next</strong>.</li>
<li>In this lab, we won't add any tags or other options. Click Next. Tags, which are key-value pairs, can help you identify your stacks. For more information, see <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide//cfn-console-add-tags.html">Adding Tags to Your AWS CloudFormation Stack</a>.</li>
<li>Review the information for the stack. When you're satisfied with the configuration, check <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong> then click <strong>Create stack</strong>.<br />
<img alt="cloudformation-createstack-final" src="../Images/cloudformation-createstack-final.png" />  </li>
<li>After a few minutes the stack status should change from <em>CREATE_IN_PROGRESS</em> to <em>CREATE_COMPLETE</em>.
You have now set up AWS Config to log to your bucket and retain events, giving you the ability to search history and later enable pro-active monitoring of your AWS account!</li>
</ol>
<hr />
<h3 id="4-tear-down-this-lab">4. Tear down this lab <a name="tear_down"></a></h3>
<p>The following instructions will remove the resources that have a cost for running them.</p>
<p>Delete the CloudTrail stack:
1. Sign in to the AWS Management Console, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.
2. Select the <code>cloudtrail</code> stack.
3. Click the Actions button then click Delete Stack.
4. Confirm the stack and then click the Yes, Delete button.</p>
<p>Empty and delete the CloudTrail bucket:
1. Sign in to the AWS Management Console, and open the S3 console at https://console.aws.amazon.com/s3/.
2. Select the bucket name you previously created without clicking the name.
<img alt="s3-empty-bucket" src="../Images/s3-empty-bucket.png" /><br />
3. Click Empty bucket and enter the bucket name in the confirmation box.<br />
<img alt="s3-empty-confirm" src="../Images/s3-empty-confirm.png" /><br />
4. Click Confirm and the bucket will be emptied when the bottom task bar has 0 operations in progress.<br />
<img alt="s3-progress.png" src="../Images/s3-progress.png" /><br />
5. With the bucket now empty, click Delete bucket.
<img alt="s3-delete-bucket" src="../Images/s3-delete-bucket.png" />
6. Enter the bucket name in the confirmation box and click Confirm.
<img alt="s3-delete-confirm" src="../Images/s3-delete-confirm.png" /><br />
7. The bucket will then be removed from the console.</p>
<p>Delete the GuardDuty stack:
1. Sign in to the AWS Management Console, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.
2. Select the <code>guardduty</code> stack.
3. Click the Actions button then click Delete Stack.
4. Confirm the stack and then click the Yes, Delete button.</p>
<p>Delete the Config stack:
1. Sign in to the AWS Management Console, and open the CloudFormation console at https://console.aws.amazon.com/cloudformation/.
2. Select the <code>config</code> stack.
3. Click the Actions button then click Delete Stack.
4. Confirm the stack and then click the Yes, Delete button.</p>
<hr />
<h2 id="references-useful-resources">References &amp; useful resources:</h2>
<p><a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html">AWS CloudTrail User Guide</a><br />
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">AWS CloudFormation User Guide</a><br />
<a href="https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html">Amazon GuardDuty User Guide</a><br />
<a href="https://docs.aws.amazon.com/config/latest/">AWS Config User Guide</a>  </p>
<hr />
<h2 id="license">License</h2>
<p>Licensed under the Apache 2.0 and MITnoAttr License. </p>
<p>Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at</p>
<pre><code>http://aws.amazon.com/apache2.0/
</code></pre>
<p>or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
